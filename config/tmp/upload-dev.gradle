def publishArchivesType = 0
// 本地需要这样写
String localRepoURL = "file://localhost$rootDir/repo"
def pluginVersionName = "3.1.6"

apply plugin: 'maven'
if (publishArchivesType == 1) {
    uploadArchives {
        repositories {
            mavenDeployer {
                pom.project {
                    groupId "com.didichuxing.doraemonkit"
                    artifactId "dokitx-plugin"
                    version pluginVersionName
                }

                pom.withXml {
                    def node = it.asElement()
                    def nodeList = node.getElementsByTagName('dependency')
                    nodeList.each { dependency ->
                        dependency?.each { config ->
                            if (config?.textContent == 'the-one-sdk') {
                                config.parentNode.parentNode.removeChild(config.parentNode)
                            }
                            if (config?.textContent == 'onecar') {
                                config.parentNode.parentNode.removeChild(config.parentNode)
                            }
                        }
                    }
                }

            }
        }
    }
} else if (publishArchivesType == 0) {
    uploadArchives {
        repositories {
            mavenDeployer {
                pom.project {
                    groupId "com.didichuxing.doraemonkit"
                    artifactId "dokitx-plugin"
                    version pluginVersionName
                }
                pom.withXml {
                    def node = it.asElement()
                    def nodeList = node.getElementsByTagName('dependency')
                    nodeList.each { dependency ->
                        dependency?.each { config ->
                            if (config?.textContent == 'the-one-sdk') {
                                config.parentNode.parentNode.removeChild(config.parentNode)
                            }
                            if (config?.textContent == 'onecar') {
                                config.parentNode.parentNode.removeChild(config.parentNode)
                            }
                        }
                    }
                }

                repository(url: localRepoURL)
            }
        }
    }
}
